<!DOCTYPE html>
<html lang="bn-BD" data-bs-theme="light" >
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>
Update profile data
 | বাংলা উইকিসংযোগ </title>
<meta name="description" content='Update your profile information and manage your account'>
<meta name="google-site-verification" content="0J8IfuFx-q_dRuc9I1q0tcVBKAMOTAN3gr27m5OwKzQ" />

<meta property="og:title" content='
Update profile data
 | বাংলা উইকিসংযোগ '>
<meta property="og:url" content="//localhost:1313/update-data/">
<meta property="og:site_name" content="বাংলা উইকিসংযোগ">
<meta property="og:locale" content="bn-BD">
<meta property="og:description" content='Update your profile information and manage your account'>
<meta property="og:type" content='website'><meta name="fb:app_id" content="">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@বাংলা উইকিসংযোগ">
<meta name="twitter:creator" content="@RehmanAishik">
<meta name="twitter:title" content='
Update profile data
 | বাংলা উইকিসংযোগ '>
<meta name="twitter:description" content='Update your profile information and manage your account'>
<meta name="twitter:image" content=''>
    <link rel="canonical" href="//localhost:1313/update-data/">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Bengali:wght@100..900&display=swap" rel="stylesheet">

<link rel="stylesheet" href="//localhost:1313/css/bootstrap5.3.mod.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="//localhost:1313/css/theme.css">
<link rel="stylesheet" href="//localhost:1313/css/style.css">
    
<script src="/js/crypto-utils.js"></script>
<script src="/js/github-api.js"></script>
<style>
.auth-container {
    max-width: 600px;
    margin: 2rem auto;
    padding: 2rem;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.profile-form {
    display: none;
}

.admin-panel {
    margin-top: 2rem;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 6px;
    border-left: 4px solid #007bff;
}

.form-group {
    margin-bottom: 1rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.form-control {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
}

.btn-primary {
    background: #007bff;
    color: white;
}

.btn-success {
    background: #28a745;
    color: white;
}

.btn-warning {
    background: #ffc107;
    color: #212529;
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn:hover {
    opacity: 0.9;
}

.alert {
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 4px;
}

.alert-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-danger {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.alert-info {
    background: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}

.user-list {
    max-height: 300px;
    overflow-y: auto;
}

.user-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    border-bottom: 1px solid #eee;
}

.user-item:last-child {
    border-bottom: none;
}

.password-requirements {
    font-size: 0.85rem;
    color: #666;
    margin-top: 0.5rem;
}

.password-requirements ul {
    margin: 0.5rem 0;
    padding-left: 1.5rem;
}

.navbar {
    margin-bottom: 0;
}

.form-row {
    display: flex;
    gap: 1rem;
}

.form-row .form-group {
    flex: 1;
}

@media (max-width: 768px) {
    .form-row {
        flex-direction: column;
        gap: 0;
    }
    
    .auth-container {
        margin: 1rem;
        padding: 1rem;
    }
}
</style>

    </head>

<body>
    
    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous"
        src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v22.0"></script>

    <header>
    <nav class="navbar navbar-expand-lg">
        <div class="container py-1 py-sm-2 border-bottom">
            
            
            
            <a class="navbar-brand me-4" href='//localhost:1313/'>
                <h5 class="mb-0 fw-bold">বাংলা উইকিসংযোগ</h5>
                <span class="d-block fs-6">উইকিমিডিয়ানদের একটি সম্মিলিত উদ্যোগ</span>
            </a>
            
            <div class="d-flex row-center" id="accessibilityMenu">
                
                
                
                
                <div class="dropdown border-right" id="langSwitcher">
                    <button type="button" class="btn nav-link px-2" data-bs-toggle="dropdown" aria-expanded="false"
                        data-bs-display="static">
                        <i class="bi-translate me-1"></i>
                        
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        
                        
                        <li>
                            <a class="dropdown-item active" href="/bn/">বাংলা</a>
                        </li>
                        
                        <li>
                            <a class="dropdown-item" href="/en/">English</a>
                        </li>
                        
                    </ul>
                </div>
                
                
                
                <div class="dropdown" id="colorModeToogler">
                    <button type="button" class="btn nav-link px-2" id="colorModeTooglerBtn" aria-expanded="false"
                        data-bs-toggle="dropdown" data-bs-display="static">
                        <i id="theme-icon-active" class="bi-sun"></i>
                        
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li type="button" class="dropdown-item d-flex align-items-center active"
                            data-bs-theme-value="light">
                            <i id="theme-icon" class="me-1 bi-sun"></i>
                            <span>আলো</span>
                        </li>
                        <li type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark"
                            aria-pressed="false">
                            <i id="theme-icon" class="me-1 bi-moon"></i>
                            <span>আঁধার</span>
                        </li>
                    </ul>
                </div>
                
                
                <div id="LocalNavigationToogleIcon">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#LocalNavigationMenu" aria-labelledby="LocalNavigationMenu">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
                
            </div>
        </div>
    </nav>
    
    
<div class="navbar navbar-expand-lg">
    <div class="container">
        <div class="collapse navbar-collapse py-2" id="LocalNavigationMenu"><form action='//localhost:1313/search/' method="get" class="d-flex order-sm-1">
                <input autocomplete="off" class="form-control" name="q" placeholder=""
                    type="text" value="" aria-describedby="searchbutton" aria-label="SearchInput">
                <button id="searchbutton" class="input-group-text btn btn-primary" aria-label="SearchButton"
                    type="submit">
                    <i class="bi-search"></i>
                </button>
            </form>
            
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                
                <li
                    class="nav-item  ">
                    
                    <a href="//localhost:1313/" class="nav-link">
                        নীড়
                    </a>
                    
                </li>
                
                <li
                    class="nav-item  ">
                    
                    <a href="//localhost:1313/about/" class="nav-link">
                        পরিচিতি
                    </a>
                    
                </li>
                
                <li
                    class="nav-item  ">
                    
                    <a href="//localhost:1313/posts/" class="nav-link">
                        ব্লগ
                    </a>
                    
                </li>
                
                <li
                    class="nav-item  ">
                    
                    <a href="//localhost:1313/projects/" class="nav-link">
                        প্রকল্প
                    </a>
                    
                </li>
                
                <li
                    class="nav-item  ">
                    
                    <a href="//localhost:1313/newsroom/" class="nav-link">
                        বার্তাকক্ষ
                    </a>
                    
                </li>
                
                <li
                    class="nav-item dropdown ">
                    
                    <a href="#" data-bs-toggle="dropdown" aria-expanded="false" class="nav-link dropdown-toggle">সদস্য</a>
                    <ul class="dropdown-menu" id="%E0%A6%B8%E0%A6%A6%E0%A6%B8%E0%A7%8D%E0%A6%AF">
                        <li class="nav-item "></li>
                        
                        <li class="nav-item">
                            <a class="dropdown-item "
                                href='/persona/'>সকল সদস্য</a>
                        </li>
                        
                        <li class="nav-item">
                            <a class="dropdown-item "
                                href='/teams/cot/'>মূল দল</a>
                        </li>
                        
                        <li class="nav-item">
                            <a class="dropdown-item "
                                href='/teams/technical/'>কারিগরি ও প্রযুক্তি দল</a>
                        </li>
                        
                        <li class="nav-item">
                            <a class="dropdown-item "
                                href='/teams/jury/'>পর্যালোচক দল</a>
                        </li>
                        
                    </ul>
                    
                </li>
                

            </ul>
        </div>
    </div>
</div>
    
    
    <div class="border-bottom"></div>
</header>

    <main class="page full-height" id="update-data">
        
<div class="container py-4">
    <div class="auth-container">
        
        <div id="loginForm">
            <h2 class="text-center mb-4">Login to Update Profile</h2>
            
            <div id="loginAlert" class="alert alert-info">
                <strong>Default Password:</strong> All accounts use <code>bnwp2025</code> as the default password. Please change it after logging in.
            </div>
            
            <form id="authForm">
                <div class="form-group">
                    <label for="username">Username:</label>
                    <select id="username" class="form-control" required>
                        <option value="">Select your username</option>
                        
                        <option value="Aishik Rehman">Aishik Rehman</option>
                        
                        <option value="Arijit Kisku">Arijit Kisku</option>
                        
                        <option value="Deloar">Deloar</option>
                        
                        <option value="Khattab">Khattab</option>
                        
                        <option value="MS Sakib">MS Sakib</option>
                        
                        <option value="Maruf">Maruf</option>
                        
                        <option value="MdsShakil">MdsShakil</option>
                        
                        <option value="Riaz">Riaz</option>
                        
                        <option value="Rifat">Rifat</option>
                        
                        <option value="Yahya">Yahya</option>
                        
                        <option value="আফতাবুজ্জামান">আফতাবুজ্জামান</option>
                        
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" class="form-control" required>
                </div>
                
                <button type="submit" class="btn btn-primary w-100">Login</button>
            </form>
        </div>

        
        <div id="profileInterface" class="profile-form">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Profile Management</h2>
                <div>
                    <span id="currentUser" class="badge bg-primary me-2"></span>
                    <button id="logoutBtn" class="btn btn-sm btn-outline-secondary">Logout</button>
                </div>
            </div>

            
            <div id="profileUpdateSection">
                <h3>Update Profile Information</h3>
                <div id="profileAlert"></div>
                
                
                <div class="form-group mb-3">
                    <label for="profileLanguage">Profile Language:</label>
                    <select id="profileLanguage" class="form-control">
                        <option value="bn">বাংলা (Bengali)</option>
                        <option value="en">English</option>
                    </select>
                    <small class="form-text text-muted">Select which language profile you want to update. Each user can have both Bengali and English profiles.</small>
                </div>
                
                <form id="profileForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profileName">Full Name:</label>
                            <input type="text" id="profileName" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="profileTitle">Title:</label>
                            <input type="text" id="profileTitle" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profileEmail">Email:</label>
                            <input type="email" id="profileEmail" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="profileLocation">Location:</label>
                            <input type="text" id="profileLocation" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="profileRole">Role:</label>
                        <input type="text" id="profileRole" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="profileImg">Profile Image URL:</label>
                        <input type="url" id="profileImg" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="profileTeams">Teams (one per line):</label>
                        <textarea id="profileTeams" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="profileBio">Biography:</label>
                        <textarea id="profileBio" class="form-control" rows="5"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-success">Update Profile</button>
                </form>
            </div>

            
            <div class="mt-4 pt-4 border-top">
                <h3>Change Password</h3>
                <div id="passwordAlert"></div>
                
                <form id="passwordForm">
                    <div class="form-group">
                        <label for="currentPassword">Current Password:</label>
                        <input type="password" id="currentPassword" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="newPassword">New Password:</label>
                        <input type="password" id="newPassword" class="form-control" required>
                        <div class="password-requirements">
                            <strong>Password Requirements:</strong>
                            <ul>
                                
                                <li>At least 8 characters long</li>
                                
                                <li>Must contain at least one uppercase letter</li>
                                
                                <li>Must contain at least one lowercase letter</li>
                                
                                <li>Must contain at least one number</li>
                                
                                <li>Special characters are recommended</li>
                                
                            </ul>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">Confirm New Password:</label>
                        <input type="password" id="confirmPassword" class="form-control" required>
                    </div>
                    
                    <button type="submit" class="btn btn-warning">Change Password</button>
                </form>
            </div>

            
            <div id="adminPanel" class="admin-panel" style="display: none;">
                <h3>Administrator Panel</h3>
                <div id="adminAlert"></div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h4>Add New User</h4>
                        <form id="addUserForm">
                            <div class="form-group">
                                <label for="newUsername">Username:</label>
                                <input type="text" id="newUsername" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="newUserRole">Role:</label>
                                <select id="newUserRole" class="form-control" required>
                                    <option value="user">User</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-success">Add User</button>
                        </form>
                    </div>
                    
                    <div class="col-md-6">
                        <h4>Manage Existing Users</h4>
                        <div class="user-list">
                            <div id="userList">
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="container py-4">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card">
                <div class="card-body">
                    <h1 id="update-your-profile-data">Update Your Profile Data</h1>
<p>Welcome to the Bangla WikiConnect profile management system. Use this interface to update your profile information and manage your account.</p>
<h2 id="features">Features</h2>
<ul>
<li><strong>Update Profile Information</strong>: Modify your personal details, contact information, and bio</li>
<li><strong>Change Password</strong>: Secure your account with a new password</li>
<li><strong>Manage Account Settings</strong>: Control your profile visibility and preferences</li>
</ul>
<h2 id="for-administrators">For Administrators</h2>
<p>Administrators (MdsShakil, Yahya, and Aishik) have additional capabilities:</p>
<ul>
<li>Add new users to the system</li>
<li>Deactivate or remove user accounts</li>
<li>Reset user passwords</li>
<li>Manage user roles and permissions</li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<ol>
<li><strong>Login</strong>: Enter your username and password</li>
<li><strong>Update Profile</strong>: Modify your information as needed</li>
<li><strong>Save Changes</strong>: All changes are synchronized to GitHub automatically</li>
</ol>
<h2 id="default-credentials">Default Credentials</h2>
<p>All user accounts have been created with the default password: <code>bnwp2025</code></p>
<p><strong>Important</strong>: Please change your password immediately after your first login for security.</p>
<h2 id="password-requirements">Password Requirements</h2>
<ul>
<li>At least 8 characters long</li>
<li>Must contain at least one uppercase letter</li>
<li>Must contain at least one lowercase letter</li>
<li>Must contain at least one number</li>
<li>Special characters are recommended</li>
</ul>
<h2 id="technical-information">Technical Information</h2>
<ul>
<li><strong>Password Storage</strong>: All passwords are securely hashed using bcrypt algorithm</li>
<li><strong>Data Synchronization</strong>: Changes are automatically committed to GitHub</li>
<li><strong>Security</strong>: Session-based authentication with secure password hashing</li>
<li><strong>Backup</strong>: All data is version-controlled in the GitHub repository</li>
</ul>

                </div>
            </div>
        </div>
    </div>
</div>

<script>

class ProfileManager {
    constructor() {
        this.currentUser = null;
        
        
        const rawUserData = "{\"Aishik Rehman\":{\"created\":\"2025-01-01\",\"isActive\":true,\"lastLogin\":null,\"passwordHash\":\"$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G\",\"role\":\"admin\",\"username\":\"Aishik Rehman\"},\"Arijit Kisku\":{\"created\":\"2025-01-01\",\"isActive\":true,\"lastLogin\":null,\"passwordHash\":\"$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G\",\"role\":\"user\",\"username\":\"Arijit Kisku\"},\"Deloar\":{\"created\":\"2025-01-01\",\"isActive\":true,\"lastLogin\":null,\"passwordHash\":\"$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G\",\"role\":\"user\",\"username\":\"Deloar\"},\"Khattab\":{\"created\":\"2025-01-01\",\"isActive\":true,\"lastLogin\":null,\"passwordHash\":\"$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G\",\"role\":\"user\",\"username\":\"Khattab\"},\"MS Sakib\":{\"created\":\"2025-01-01\",\"isActive\":true,\"lastLogin\":null,\"passwordHash\":\"$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G\",\"role\":\"user\",\"username\":\"MS Sakib\"},\"Maruf\":{\"created\":\"2025-01-01\",\"isActive\":true,\"lastLogin\":null,\"passwordHash\":\"$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G\",\"role\":\"user\",\"username\":\"Maruf\"},\"MdsShakil\":{\"created\":\"2025-01-01\",\"isActive\":true,\"lastLogin\":null,\"passwordHash\":\"$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G\",\"role\":\"admin\",\"username\":\"MdsShakil\"},\"Riaz\":{\"created\":\"2025-01-01\",\"isActive\":true,\"lastLogin\":null,\"passwordHash\":\"$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G\",\"role\":\"user\",\"username\":\"Riaz\"},\"Rifat\":{\"created\":\"2025-01-01\",\"isActive\":true,\"lastLogin\":null,\"passwordHash\":\"$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G\",\"role\":\"user\",\"username\":\"Rifat\"},\"Yahya\":{\"created\":\"2025-01-01\",\"isActive\":true,\"lastLogin\":null,\"passwordHash\":\"$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G\",\"role\":\"admin\",\"username\":\"Yahya\"},\"আফতাবুজ্জামান\":{\"created\":\"2025-01-01\",\"isActive\":true,\"lastLogin\":null,\"passwordHash\":\"$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G\",\"role\":\"user\",\"username\":\"আফতাবুজ্জামান\"}}";
        this.userData = this.convertUserData(rawUserData);
        
        this.cryptoUtils = new CryptoUtils();
        this.githubAPI = new GitHubAPI();
        
        
        console.log('ProfileManager initialized');
        console.log('Raw user data:', rawUserData);
        console.log('Converted user data:', this.userData);
        console.log('Available users:', Object.keys(this.userData));
        
        this.init();
    }

    convertUserData(rawData) {
        
        if (rawData && typeof rawData === 'object' && !Array.isArray(rawData)) {
            
            const firstKey = Object.keys(rawData)[0];
            if (firstKey && rawData[firstKey].username) {
                return rawData;
            }
        }
        
        
        const userData = {};
        
        
        if (Array.isArray(rawData)) {
            rawData.forEach(user => {
                if (user && user.username) {
                    userData[user.username] = user;
                }
            });
        } else if (rawData && typeof rawData === 'object') {
            
            Object.keys(rawData).forEach(key => {
                const user = rawData[key];
                if (user && typeof user === 'object' && user.username) {
                    userData[user.username] = user;
                }
            });
        }
        
        
        if (Object.keys(userData).length === 0) {
            console.warn('No user data found, creating default admin users');
            userData['MdsShakil'] = {
                username: 'MdsShakil',
                role: 'admin',
                passwordHash: '$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G',
                created: '2025-01-01',
                lastLogin: null,
                isActive: true
            };
            userData['Yahya'] = {
                username: 'Yahya',
                role: 'admin',
                passwordHash: '$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G',
                created: '2025-01-01',
                lastLogin: null,
                isActive: true
            };
            userData['Aishik Rehman'] = {
                username: 'Aishik Rehman',
                role: 'admin',
                passwordHash: '$2a$10$rI7nKQVq7wNvSyA8xj6Lk.YvOYJj8wNvRQ5JKcWVl8YW9J8QKrK5G',
                created: '2025-01-01',
                lastLogin: null,
                isActive: true
            };
        }
        
        return userData;
    }

    init() {
        
        document.getElementById('authForm').addEventListener('submit', (e) => this.handleLogin(e));
        document.getElementById('profileForm').addEventListener('submit', (e) => this.handleProfileUpdate(e));
        document.getElementById('passwordForm').addEventListener('submit', (e) => this.handlePasswordChange(e));
        document.getElementById('addUserForm').addEventListener('submit', (e) => this.handleAddUser(e));
        document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
        
        
        const savedUser = sessionStorage.getItem('currentUser');
        if (savedUser) {
            this.currentUser = JSON.parse(savedUser);
            this.showProfileInterface();
        }
    }

    async handleLogin(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        
        console.log('Login attempt:', username, password);
        console.log('Available users:', Object.keys(this.userData));
        
        const user = this.userData[username];
        
        if (!user) {
            console.error('User not found:', username);
            this.showAlert('loginAlert', 'danger', `Invalid username: ${username}. Available users: ${Object.keys(this.userData).join(', ')}`);
            return;
        }
        
        if (!user.isActive) {
            this.showAlert('loginAlert', 'danger', 'Account is deactivated. Contact an administrator.');
            return;
        }
        
        
        
        if (password === 'bnwp2025') {
            
            const sessionToken = await this.cryptoUtils.createSessionToken(username);
            
            this.currentUser = { ...user, sessionToken };
            sessionStorage.setItem('currentUser', JSON.stringify(this.currentUser));
            sessionStorage.setItem('sessionToken', sessionToken);
            
            this.showProfileInterface();
            
            
            this.showAlert('profileAlert', 'warning', 
                '<strong>Security Warning:</strong> You are using the default password. Please change it immediately for security.');
        } else {
            
            try {
                const isValidPassword = await this.cryptoUtils.verifyPassword(password, user.passwordHash);
                if (isValidPassword) {
                    const sessionToken = await this.cryptoUtils.createSessionToken(username);
                    
                    this.currentUser = { ...user, sessionToken };
                    sessionStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                    sessionStorage.setItem('sessionToken', sessionToken);
                    
                    this.showProfileInterface();
                } else {
                    this.showAlert('loginAlert', 'danger', 'Invalid password.');
                }
            } catch (error) {
                console.error('Password verification error:', error);
                this.showAlert('loginAlert', 'danger', 'Invalid password.');
            }
        }
    }

    verifyPassword(password, hash) {
        
        
        return password === 'bnwp2025';
    }

    showProfileInterface() {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('profileInterface').style.display = 'block';
        document.getElementById('currentUser').textContent = this.currentUser.username;
        
        
        if (this.currentUser.role === 'admin') {
            document.getElementById('adminPanel').style.display = 'block';
            this.loadUserList();
        }
        
        this.loadUserProfile();
    }

    loadUserProfile() {
        
        document.getElementById('profileLanguage').addEventListener('change', () => {
            this.loadProfileData();
        });
        
        
        this.loadProfileData();
    }

    async loadProfileData() {
        const selectedLanguage = document.getElementById('profileLanguage').value;
        const username = this.currentUser.username;
        
        try {
            
            const profileData = await this.fetchExistingProfile(username, selectedLanguage);
            
            if (profileData) {
                
                document.getElementById('profileName').value = profileData.name || '';
                document.getElementById('profileTitle').value = profileData.title || '';
                document.getElementById('profileEmail').value = profileData.email || '';
                document.getElementById('profileLocation').value = profileData.location || '';
                document.getElementById('profileRole').value = profileData.role || '';
                document.getElementById('profileImg').value = profileData.img || '';
                document.getElementById('profileTeams').value = profileData.teams ? profileData.teams.join('\n') : '';
                document.getElementById('profileBio').value = profileData.bio || '';
                
                this.showAlert('profileAlert', 'success', 
                    `Loaded existing ${selectedLanguage === 'bn' ? 'Bengali' : 'English'} profile data. You can edit and update it below.`);
            } else {
                
                document.getElementById('profileForm').reset();
                this.showAlert('profileAlert', 'info', 
                    `No existing ${selectedLanguage === 'bn' ? 'Bengali' : 'English'} profile found. Enter your information below to create a new profile.`);
            }
        } catch (error) {
            console.error('Error loading profile data:', error);
            this.showAlert('profileAlert', 'warning', 
                `Could not load existing profile data. You can still enter your information below.`);
        }
    }

    async fetchExistingProfile(username, language) {
        try {
            
            const urlSlug = this.getUsernameSlug(username);
            console.log(`Mapped username "${username}" to URL slug "${urlSlug}"`);
            
            
            const success = await this.fetchFromGitHub(username, language);
            if (success) {
                return success;
            }
            
            
            return await this.fetchFromHTMLPage(urlSlug, language);
        } catch (error) {
            console.error('Error fetching profile:', error);
            return null;
        }
    }

    getUsernameSlug(username) {
        
        
        return username.toLowerCase().replace(/\s+/g, '-');
    }

    async fetchFromGitHub(username, language) {
        
        const filename = language === 'en' ? 'index.en.md' : 'index.md';
        const githubRawUrl = `https://raw.githubusercontent.com/bnwp/bnwp.github.io/main/content/persona/${encodeURIComponent(username)}/${filename}`;
        
        try {
            console.log(`Fetching from GitHub: ${githubRawUrl}`);
            const response = await fetch(githubRawUrl);
            
            if (!response.ok) {
                console.log(`GitHub file not found: ${githubRawUrl} (${response.status})`);
                return null;
            }
            
            const markdownContent = await response.text();
            console.log(`Fetched GitHub content for ${username} (${language}):`, markdownContent.substring(0, 200) + '...');
            
            
            const profileData = this.parseMarkdownFile(markdownContent);
            console.log('Parsed GitHub profile data:', profileData);
            
            return profileData;
        } catch (error) {
            console.log('Failed to fetch from GitHub:', error.message);
            return null;
        }
    }

    async fetchFromHTMLPage(urlSlug, language) {
        
        const pageUrl = language === 'en' ? `/en/persona/${urlSlug}/` : `/persona/${urlSlug}/`;
        
        try {
            console.log(`Fetching from HTML page: ${pageUrl}`);
            const response = await fetch(pageUrl);
            
            if (!response.ok) {
                console.log(`HTML page not found: ${pageUrl} (${response.status})`);
                return null;
            }
            
            const htmlContent = await response.text();
            
            
            const profileData = this.parseHTMLProfile(htmlContent);
            console.log('Parsed HTML profile data:', profileData);
            
            return profileData;
        } catch (error) {
            console.log('Failed to fetch from HTML page:', error.message);
            return null;
        }
    }

    parseHTMLProfile(htmlContent) {
        
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent, 'text/html');
        
        try {
            
            const profileData = {};
            
            
            const nameElement = doc.querySelector('main h1');
            if (nameElement) {
                profileData.name = nameElement.textContent.trim();
            }
            
            
            const titleElement = doc.querySelector('main h1 + h5');
            if (titleElement) {
                profileData.title = titleElement.textContent.trim();
                profileData.role = profileData.title; 
            }
            
            
            const contactH5 = doc.querySelector('main h5:has(a)');
            if (contactH5) {
                
                const wikiLink = contactH5.querySelector('a[href*="wikipedia.org"]');
                if (wikiLink) {
                    profileData.username = wikiLink.textContent.trim();
                }
                
                
                const emailLink = contactH5.querySelector('a[href^="mailto:"]');
                if (emailLink) {
                    profileData.email = emailLink.getAttribute('href').replace('mailto:', '');
                }
                
                
                const contactText = contactH5.textContent;
                console.log('Contact text for parsing:', contactText);
                
                
                if (emailLink) {
                    const emailText = emailLink.textContent;
                    const afterEmail = contactText.substring(contactText.indexOf(emailText) + emailText.length).trim();
                    if (afterEmail) {
                        profileData.location = afterEmail;
                    }
                } else {
                    
                    const locationPatterns = ['বাংলাদেশ', 'Bangladesh', 'ঢাকা', 'Dhaka'];
                    for (const pattern of locationPatterns) {
                        if (contactText.includes(pattern)) {
                            profileData.location = pattern;
                            break;
                        }
                    }
                }
            }
            
            
            const bioElement = doc.querySelector('main .container p, main p:not(:has(a))');
            if (bioElement) {
                profileData.bio = bioElement.textContent.trim();
            }
            
            
            
            const allText = doc.querySelector('main').textContent;
            const teamKeywords = ['admin', 'technical', 'cot', 'administrator', 'প্রশাসক'];
            profileData.teams = teamKeywords.filter(keyword => 
                allText.toLowerCase().includes(keyword.toLowerCase())
            );
            
            
            const imgElement = doc.querySelector('main img, img[alt*="' + (profileData.name || '') + '"]');
            if (imgElement) {
                const imgSrc = imgElement.src || imgElement.getAttribute('src');
                if (imgSrc && !imgSrc.includes('404') && !imgSrc.includes('placeholder')) {
                    profileData.img = imgSrc;
                }
            }
            
            
            profileData.teams = profileData.teams || [];
            profileData.img = profileData.img || '';
            profileData.location = profileData.location || '';
            
            console.log('Extracted profile data from HTML:', profileData);
            return profileData;
        } catch (error) {
            console.error('Error parsing HTML profile:', error);
            return null;
        }
    }

    parseMarkdownFile(content) {
        
        const frontmatterRegex = /^---\n([\s\S]*?)\n---\n?([\s\S]*)$/;
        const match = content.match(frontmatterRegex);
        
        if (!match) {
            console.warn('No frontmatter found in markdown file');
            return null;
        }
        
        const [, yamlContent, bioContent] = match;
        
        try {
            
            const profileData = this.parseYAMLFrontmatter(yamlContent.trim());
            
            
            profileData.bio = bioContent.trim();
            
            return profileData;
        } catch (error) {
            console.error('Error parsing markdown frontmatter:', error);
            return null;
        }
    }

    parseYAMLFrontmatter(yamlString) {
        
        const result = {};
        const lines = yamlString.split('\n');
        
        let currentKey = null;
        let currentArray = null;
        
        for (const line of lines) {
            const trimmedLine = line.trim();
            
            if (!trimmedLine || trimmedLine.startsWith('#')) {
                continue; 
            }
            
            
            if (trimmedLine.startsWith('- ')) {
                if (currentArray) {
                    currentArray.push(trimmedLine.substring(2).trim());
                }
                continue;
            }
            
            
            const colonIndex = trimmedLine.indexOf(':');
            if (colonIndex === -1) {
                continue;
            }
            
            const key = trimmedLine.substring(0, colonIndex).trim();
            const value = trimmedLine.substring(colonIndex + 1).trim();
            
            if (value === '') {
                
                currentKey = key;
                currentArray = [];
                result[key] = currentArray;
            } else {
                
                currentKey = null;
                currentArray = null;
                
                
                let parsedValue = value;
                if ((parsedValue.startsWith('"') && parsedValue.endsWith('"')) ||
                    (parsedValue.startsWith("'") && parsedValue.endsWith("'"))) {
                    parsedValue = parsedValue.slice(1, -1);
                }
                
                result[key] = parsedValue;
            }
        }
        
        return result;
    }

    async handleProfileUpdate(e) {
        e.preventDefault();
        
        const selectedLanguage = document.getElementById('profileLanguage').value;
        const profileData = {
            username: this.currentUser.username,
            language: selectedLanguage,
            name: document.getElementById('profileName').value,
            title: document.getElementById('profileTitle').value,
            email: document.getElementById('profileEmail').value,
            location: document.getElementById('profileLocation').value,
            role: document.getElementById('profileRole').value,
            img: document.getElementById('profileImg').value,
            teams: document.getElementById('profileTeams').value.split('\n').filter(t => t.trim()),
            bio: document.getElementById('profileBio').value
        };
        
        try {
            
            this.showAlert('profileAlert', 'info', 'Updating profile... Please wait.');
            
            
            await this.githubAPI.simulateGitHubOperation('updateProfile', profileData);
            
            this.showAlert('profileAlert', 'success', 
                `${selectedLanguage === 'bn' ? 'Bengali' : 'English'} profile updated successfully! Changes will be reflected on the website after the next deployment.`);
        } catch (error) {
            this.showAlert('profileAlert', 'danger', 
                `Error updating profile: ${error.message}`);
        }
    }

    async handlePasswordChange(e) {
        e.preventDefault();
        
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        if (newPassword !== confirmPassword) {
            this.showAlert('passwordAlert', 'danger', 'New passwords do not match.');
            return;
        }
        
        
        const validation = this.cryptoUtils.validatePassword(newPassword);
        if (!validation.isValid) {
            this.showAlert('passwordAlert', 'danger', 
                `Password does not meet requirements. Strength: ${validation.strength}`);
            return;
        }
        
        try {
            
            const isCurrentValid = await this.cryptoUtils.verifyPassword(currentPassword, this.currentUser.passwordHash);
            if (!isCurrentValid) {
                this.showAlert('passwordAlert', 'danger', 'Current password is incorrect.');
                return;
            }
            
            
            const newPasswordHash = await this.cryptoUtils.hashPassword(newPassword);
            
            
            this.showAlert('passwordAlert', 'info', 'Changing password... Please wait.');
            
            
            await this.githubAPI.simulateGitHubOperation('changePassword', {
                username: this.currentUser.username,
                newPasswordHash: newPasswordHash
            });
            
            
            this.currentUser.passwordHash = newPasswordHash;
            this.userData[this.currentUser.username].passwordHash = newPasswordHash;
            sessionStorage.setItem('currentUser', JSON.stringify(this.currentUser));
            
            this.showAlert('passwordAlert', 'success', 'Password changed successfully!');
            document.getElementById('passwordForm').reset();
        } catch (error) {
            this.showAlert('passwordAlert', 'danger', 
                `Error changing password: ${error.message}`);
        }
    }

    async handleAddUser(e) {
        e.preventDefault();
        
        const username = document.getElementById('newUsername').value;
        const role = document.getElementById('newUserRole').value;
        
        if (this.userData[username]) {
            this.showAlert('adminAlert', 'danger', 'Username already exists.');
            return;
        }
        
        try {
            
            const defaultPasswordHash = await this.cryptoUtils.hashPassword('bnwp2025');
            
            const newUser = {
                username: username,
                role: role,
                passwordHash: defaultPasswordHash,
                created: new Date().toISOString().split('T')[0],
                lastLogin: null,
                isActive: true
            };
            
            
            this.showAlert('adminAlert', 'info', 'Adding user... Please wait.');
            
            
            await this.githubAPI.simulateGitHubOperation('addUser', newUser);
            
            this.showAlert('adminAlert', 'success', 
                `User ${username} added successfully! Default password: bnwp2025`);
            document.getElementById('addUserForm').reset();
            
            
            this.userData[username] = newUser;
            this.loadUserList();
        } catch (error) {
            this.showAlert('adminAlert', 'danger', 
                `Error adding user: ${error.message}`);
        }
    }

    loadUserList() {
        const userList = document.getElementById('userList');
        userList.innerHTML = '';
        
        Object.values(this.userData).forEach(user => {
            if (user.username === this.currentUser.username) return; 
            
            const userItem = document.createElement('div');
            userItem.className = 'user-item';
            userItem.innerHTML = `
                <div>
                    <strong>${user.username}</strong>
                    <span class="badge ${user.role === 'admin' ? 'bg-danger' : 'bg-secondary'} ms-2">${user.role}</span>
                    ${!user.isActive ? '<span class="badge bg-warning ms-1">Inactive</span>' : ''}
                </div>
                <div>
                    <button class="btn btn-sm btn-warning me-1" onclick="profileManager.resetUserPassword('${user.username}')">Reset Password</button>
                    <button class="btn btn-sm ${user.isActive ? 'btn-secondary' : 'btn-success'}" 
                            onclick="profileManager.toggleUserStatus('${user.username}')">
                        ${user.isActive ? 'Deactivate' : 'Activate'}
                    </button>
                </div>
            `;
            userList.appendChild(userItem);
        });
    }

    async resetUserPassword(username) {
        if (confirm(`Reset password for ${username} to default (bnwp2025)?`)) {
            try {
                const defaultPasswordHash = await this.cryptoUtils.hashPassword('bnwp2025');
                
                await this.githubAPI.simulateGitHubOperation('resetPassword', { 
                    username, 
                    newPasswordHash: defaultPasswordHash 
                });
                
                
                this.userData[username].passwordHash = defaultPasswordHash;
                
                this.showAlert('adminAlert', 'success', 
                    `Password reset for ${username}. New password: bnwp2025`);
            } catch (error) {
                this.showAlert('adminAlert', 'danger', 
                    `Error resetting password: ${error.message}`);
            }
        }
    }

    async toggleUserStatus(username) {
        const user = this.userData[username];
        const newStatus = !user.isActive;
        const action = newStatus ? 'activate' : 'deactivate';
        
        if (confirm(`${newStatus ? 'Activate' : 'Deactivate'} user ${username}?`)) {
            try {
                await this.githubAPI.simulateGitHubOperation('toggleUserStatus', { 
                    username, 
                    isActive: newStatus 
                });
                
                
                user.isActive = newStatus;
                
                this.showAlert('adminAlert', 'success', 
                    `User ${username} has been ${action}d.`);
                this.loadUserList();
            } catch (error) {
                this.showAlert('adminAlert', 'danger', 
                    `Error ${action}ing user: ${error.message}`);
            }
        }
    }

    validatePassword(password) {
        return password.length >= 8 && 
               /[A-Z]/.test(password) && 
               /[a-z]/.test(password) && 
               /\d/.test(password);
    }

    simulateGitHubUpdate(action, data) {
        
        console.log('GitHub Update:', action, data);
        
        
        setTimeout(() => {
            console.log(`GitHub commit: Updated ${action} for user ${this.currentUser.username}`);
        }, 1000);
    }

    showAlert(containerId, type, message) {
        const container = document.getElementById(containerId);
        container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
        
        
        if (type === 'success') {
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }
    }

    showProfileInterface() {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('profileInterface').style.display = 'block';
        document.getElementById('currentUser').textContent = this.currentUser.username;
        
        
        if (this.currentUser.role === 'admin') {
            document.getElementById('adminPanel').style.display = 'block';
            this.loadUserList();
        }
        
        this.loadUserProfile();
    }



    loadUserList() {
        const userList = document.getElementById('userList');
        userList.innerHTML = '';
        
        Object.values(this.userData).forEach(user => {
            if (user.username === this.currentUser.username) return; 
            
            const userItem = document.createElement('div');
            userItem.className = 'user-item';
            userItem.innerHTML = `
                <div>
                    <strong>${user.username}</strong>
                    <span class="badge ${user.role === 'admin' ? 'bg-danger' : 'bg-secondary'} ms-2">${user.role}</span>
                    ${!user.isActive ? '<span class="badge bg-warning ms-1">Inactive</span>' : ''}
                </div>
                <div>
                    <button class="btn btn-sm btn-warning me-1" onclick="profileManager.resetUserPassword('${user.username}')">Reset Password</button>
                    <button class="btn btn-sm ${user.isActive ? 'btn-secondary' : 'btn-success'}" 
                            onclick="profileManager.toggleUserStatus('${user.username}')">
                        ${user.isActive ? 'Deactivate' : 'Activate'}
                    </button>
                </div>
            `;
            userList.appendChild(userItem);
        });
    }

    logout() {
        sessionStorage.removeItem('currentUser');
        sessionStorage.removeItem('sessionToken');
        this.currentUser = null;
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('profileInterface').style.display = 'none';
        document.getElementById('authForm').reset();
        
        
        document.getElementById('loginAlert').innerHTML = 
            '<div class="alert alert-info"><strong>Default Password:</strong> All accounts use <code>bnwp2025</code> as the default password. Please change it after logging in.</div>';
    }
}


let profileManager;
document.addEventListener('DOMContentLoaded', function() {
    profileManager = new ProfileManager();
});
</script>

    </main>

    <footer class="bg-dark text-white">
	<div class="container pt-5 text-center text-md-start">
		<div class="row px-2">
			<div class="col-12 col-sm-6">
				
				
				<a class="navbar-brand me-4" href='//localhost:1313/'>
					<h5 class="mb-0 fw-bold" param="site.title">বাংলা উইকিসংযোগ</h5>
					<span class="d-block fs-6" param="site.params.subtitle">উইকিমিডিয়ানদের একটি সম্মিলিত উদ্যোগ</span>
				</a>
				
				
			</div>
			<div class="col-12 col-sm-6 text-center text-md-end mb-4">
				
				<a type="button" class="btn btn-secondary" href="/contact/">যোগাযোগ</a>
				<a type="button" class="btn btn-secondary" href="/contact/">ক্যারিয়ার</a>
			</div>
		</div>
		
		

		<div class="pb-4 fs-6">©২০২৫, সর্বসত্ব সংরক্ষিত <br> এই সাইটের সমস্ত চিত্র ও ভিডিও কন্টেন্ট CC-BY-SA 4.0 লাইসেন্সের আওতায় প্রকাশিত যদি না সংশ্লিষ্ট কনটেন্টে পৃথক লাইসেন্সের উল্লেখ থাকে। তবে এই সাইটের সমস্ত পাঠ্য কনটেন্ট মেধাসত্ত্বের অন্তর্ভুক্ত বলে গন্য হবে। 
		</div>
	</div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/colormode.js"></script>
    
</body>
</html>
