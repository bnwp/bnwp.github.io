{{ define "head" }}
<style>
.auth-container {
    max-width: 500px;
    margin: 0 auto;
    padding: 2rem;
}

.profile-form {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
}

.form-section {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 1.5rem;
}

.preview-avatar {
    width: 120px;
    height: 120px;
    object-fit: cover;
    border-radius: 50%;
    border: 3px solid #dee2e6;
}

.hidden {
    display: none !important;
}

.alert {
    padding: 0.75rem 1.25rem;
    margin-bottom: 1rem;
    border: 1px solid transparent;
    border-radius: 0.25rem;
}

.alert-success {
    color: #155724;
    background-color: #d4edda;
    border-color: #c3e6cb;
}

.alert-danger {
    color: #721c24;
    background-color: #f8d7da;
    border-color: #f5c6cb;
}

.btn-primary {
    background-color: #007bff;
    border-color: #007bff;
}

.btn-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
}
</style>
{{ end }}

{{ define "main" }}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-12">
            <h1 class="text-center mb-4">{{ .Title }}</h1>
            
            <!-- Login Form -->
            <div id="loginContainer" class="auth-container">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title mb-0">{{ if eq .Site.Language.Lang "bn" }}লগইন করুন{{ else }}Login{{ end }}</h3>
                    </div>
                    <div class="card-body">
                        <div id="loginAlert" class="alert alert-danger hidden"></div>
                        <form id="loginForm">
                            <div class="mb-3">
                                <label for="username" class="form-label">{{ if eq .Site.Language.Lang "bn" }}ব্যবহারকারী নাম{{ else }}Username{{ end }}</label>
                                <input type="text" class="form-control" id="username" required 
                                       placeholder="{{ if eq .Site.Language.Lang "bn" }}আপনার ব্যবহারকারী নাম লিখুন{{ else }}Enter your username{{ end }}">
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">{{ if eq .Site.Language.Lang "bn" }}পাসওয়ার্ড{{ else }}Password{{ end }}</label>
                                <input type="password" class="form-control" id="password" required 
                                       placeholder="{{ if eq .Site.Language.Lang "bn" }}আপনার পাসওয়ার্ড লিখুন{{ else }}Enter your password{{ end }}">
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                {{ if eq .Site.Language.Lang "bn" }}লগইন{{ else }}Login{{ end }}
                            </button>
                        </form>
                        <div class="mt-3">
                            <small class="text-muted">
                                {{ if eq .Site.Language.Lang "bn" }}
                                    ডেমো: ব্যবহারকারী নাম "Aishik Rehman", পাসওয়ার্ড "demo123"
                                {{ else }}
                                    Demo: Username "Aishik Rehman", Password "demo123"
                                {{ end }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Update Form -->
            <div id="profileContainer" class="profile-form hidden">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 id="welcomeMessage"></h3>
                    <button id="logoutBtn" class="btn btn-secondary">
                        {{ if eq .Site.Language.Lang "bn" }}লগআউট{{ else }}Logout{{ end }}
                    </button>
                </div>

                <div id="profileAlert" class="alert alert-success hidden"></div>

                <form id="profileForm">
                    <!-- Profile Image Section -->
                    <div class="form-section">
                        <h4 class="mb-3">{{ if eq .Site.Language.Lang "bn" }}প্রোফাইল ছবি{{ else }}Profile Image{{ end }}</h4>
                        <div class="row align-items-center">
                            <div class="col-md-3 text-center">
                                <img id="previewImage" src="https://upload.wikimedia.org/wikipedia/commons/9/9e/Male_Avatar.jpg" 
                                     alt="Profile Preview" class="preview-avatar">
                            </div>
                            <div class="col-md-9">
                                <label for="img" class="form-label">{{ if eq .Site.Language.Lang "bn" }}ছবির URL{{ else }}Image URL{{ end }}</label>
                                <input type="url" class="form-control" id="img" 
                                       placeholder="{{ if eq .Site.Language.Lang "bn" }}আপনার প্রোফাইল ছবির URL{{ else }}Your profile image URL{{ end }}">
                            </div>
                        </div>
                    </div>

                    <!-- Basic Information Section -->
                    <div class="form-section">
                        <h4 class="mb-3">{{ if eq .Site.Language.Lang "bn" }}মৌলিক তথ্য{{ else }}Basic Information{{ end }}</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="name" class="form-label">{{ if eq .Site.Language.Lang "bn" }}পূর্ণ নাম{{ else }}Full Name{{ end }} *</label>
                                <input type="text" class="form-control" id="name" required>
                            </div>
                            <div class="col-md-6">
                                <label for="usernameField" class="form-label">{{ if eq .Site.Language.Lang "bn" }}ব্যবহারকারী নাম{{ else }}Username{{ end }} *</label>
                                <input type="text" class="form-control" id="usernameField" required readonly>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label for="email" class="form-label">{{ if eq .Site.Language.Lang "bn" }}ইমেইল{{ else }}Email{{ end }}</label>
                                <input type="email" class="form-control" id="email">
                            </div>
                            <div class="col-md-6">
                                <label for="location" class="form-label">{{ if eq .Site.Language.Lang "bn" }}অবস্থান{{ else }}Location{{ end }}</label>
                                <input type="text" class="form-control" id="location">
                            </div>
                        </div>
                        <div class="mt-3">
                            <label for="role" class="form-label">{{ if eq .Site.Language.Lang "bn" }}ভূমিকা{{ else }}Role{{ end }}</label>
                            <input type="text" class="form-control" id="role" 
                                   placeholder="{{ if eq .Site.Language.Lang "bn" }}যেমন: প্রযুক্তিগত উপদেষ্টা{{ else }}e.g., Technical Advisor{{ end }}">
                        </div>
                    </div>

                    <!-- Teams Section -->
                    <div class="form-section">
                        <h4 class="mb-3">{{ if eq .Site.Language.Lang "bn" }}দল সমূহ{{ else }}Teams{{ end }}</h4>
                        <div class="row">
                            <div class="col-md-12">
                                <label class="form-label">{{ if eq .Site.Language.Lang "bn" }}কোন দলে সদস্য{{ else }}Team Memberships{{ end }}</label>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="cot" id="teamCot">
                                            <label class="form-check-label" for="teamCot">CoT</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="technical" id="teamTechnical">
                                            <label class="form-check-label" for="teamTechnical">{{ if eq .Site.Language.Lang "bn" }}প্রযুক্তিগত{{ else }}Technical{{ end }}</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="language" id="teamLanguage">
                                            <label class="form-check-label" for="teamLanguage">{{ if eq .Site.Language.Lang "bn" }}ভাষা{{ else }}Language{{ end }}</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="jury" id="teamJury">
                                            <label class="form-check-label" for="teamJury">{{ if eq .Site.Language.Lang "bn" }}জুরি{{ else }}Jury{{ end }}</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bio Section -->
                    <div class="form-section">
                        <h4 class="mb-3">{{ if eq .Site.Language.Lang "bn" }}জীবনী{{ else }}Biography{{ end }}</h4>
                        <textarea class="form-control" id="bio" rows="6" 
                                  placeholder="{{ if eq .Site.Language.Lang "bn" }}আপনার সম্পর্কে বিস্তারিত লিখুন...{{ else }}Write detailed information about yourself...{{ end }}"></textarea>
                    </div>

                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg px-5">
                            {{ if eq .Site.Language.Lang "bn" }}প্রোফাইল আপডেট করুন{{ else }}Update Profile{{ end }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{{ end }}

{{ define "script" }}
<script>
// Demo user data - in a real application, this would come from a backend
const demoUsers = {
    "Aishik Rehman": {
        password: "demo123",
        profile: {
            name: "Aishik Rehman",
            username: "Aishik Rehman",
            email: "aishikrehman@gmail.com",
            location: "Bangladesh",
            role: "Visual Designer and Technical Advisor",
            teams: ["cot", "technical", "language"],
            bio: `Hi! This is Aishik Rehman (বাংলা: ঐশিক রেহমান, IPA: o͡i̯ʃik rehoman), a practitioner in Computer Science and Engineering from Bangladesh. I am passionate about Human Language and Artificial Intelligence, focusing on expanding multilingual access to knowledge and developing open resources.

Active since 2018, I contribute to multilingual Wikimedia projects in Bengali, Bishnupriya Manipuri, English, and Assamese. All of my contributions on Wikimedia projects can be found via CentralAuth.`,
            img: "https://upload.wikimedia.org/wikipedia/commons/3/33/Aishik_Rehman_at_Wikimania_Bangladesh_-_2.png"
        }
    }
};

// Current logged in user
let currentUser = null;

// DOM elements
const loginContainer = document.getElementById('loginContainer');
const profileContainer = document.getElementById('profileContainer');
const loginForm = document.getElementById('loginForm');
const profileForm = document.getElementById('profileForm');
const loginAlert = document.getElementById('loginAlert');
const profileAlert = document.getElementById('profileAlert');
const welcomeMessage = document.getElementById('welcomeMessage');
const previewImage = document.getElementById('previewImage');

// Login functionality
loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    if (demoUsers[username] && demoUsers[username].password === password) {
        currentUser = username;
        showProfile(demoUsers[username].profile);
        hideAlert(loginAlert);
    } else {
        showAlert(loginAlert, '{{ if eq .Site.Language.Lang "bn" }}ভুল ব্যবহারকারী নাম বা পাসওয়ার্ড{{ else }}Invalid username or password{{ end }}', 'danger');
    }
});

// Logout functionality
document.getElementById('logoutBtn').addEventListener('click', function() {
    currentUser = null;
    loginContainer.classList.remove('hidden');
    profileContainer.classList.add('hidden');
    loginForm.reset();
    hideAlert(loginAlert);
    hideAlert(profileAlert);
});

// Profile form functionality
profileForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Collect form data
    const formData = {
        name: document.getElementById('name').value,
        username: document.getElementById('usernameField').value,
        email: document.getElementById('email').value,
        location: document.getElementById('location').value,
        role: document.getElementById('role').value,
        bio: document.getElementById('bio').value,
        img: document.getElementById('img').value,
        teams: getSelectedTeams()
    };
    
    // In a real application, you would send this data to a backend
    console.log('Profile data to save:', formData);
    
    // Show success message
    showAlert(profileAlert, '{{ if eq .Site.Language.Lang "bn" }}প্রোফাইল সফলভাবে আপডেট হয়েছে!{{ else }}Profile updated successfully!{{ end }}', 'success');
    
    // Scroll to top to show the alert
    profileContainer.scrollIntoView({ behavior: 'smooth' });
});

// Image preview functionality
document.getElementById('img').addEventListener('input', function(e) {
    const imageUrl = e.target.value;
    if (imageUrl) {
        previewImage.src = imageUrl;
        previewImage.onerror = function() {
            previewImage.src = "https://upload.wikimedia.org/wikipedia/commons/9/9e/Male_Avatar.jpg";
        };
    } else {
        previewImage.src = "https://upload.wikimedia.org/wikipedia/commons/9/9e/Male_Avatar.jpg";
    }
});

// Helper functions
function showProfile(profile) {
    loginContainer.classList.add('hidden');
    profileContainer.classList.remove('hidden');
    
    welcomeMessage.textContent = '{{ if eq .Site.Language.Lang "bn" }}স্বাগতম{{ else }}Welcome{{ end }}, ' + profile.name;
    
    // Populate form with current data
    document.getElementById('name').value = profile.name || '';
    document.getElementById('usernameField').value = profile.username || '';
    document.getElementById('email').value = profile.email || '';
    document.getElementById('location').value = profile.location || '';
    document.getElementById('role').value = profile.role || '';
    document.getElementById('bio').value = profile.bio || '';
    document.getElementById('img').value = profile.img || '';
    
    if (profile.img) {
        previewImage.src = profile.img;
    }
    
    // Set team checkboxes
    setSelectedTeams(profile.teams || []);
}

function getSelectedTeams() {
    const teams = [];
    const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
    checkboxes.forEach(checkbox => {
        teams.push(checkbox.value);
    });
    return teams;
}

function setSelectedTeams(teams) {
    // Clear all checkboxes first
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
        checkbox.checked = false;
    });
    
    // Set selected teams
    teams.forEach(team => {
        const checkbox = document.querySelector(`input[value="${team}"]`);
        if (checkbox) {
            checkbox.checked = true;
        }
    });
}

function showAlert(alertElement, message, type) {
    alertElement.className = `alert alert-${type}`;
    alertElement.textContent = message;
    alertElement.classList.remove('hidden');
}

function hideAlert(alertElement) {
    alertElement.classList.add('hidden');
}
</script>
{{ end }}